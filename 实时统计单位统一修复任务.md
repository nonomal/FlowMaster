# 上下文
文件名：实时统计单位统一修复任务.md
创建于：2025-01-27
创建者：AI Assistant
关联协议：RIPER-5 + Multidimensional + Agent Protocol 

# 任务描述
修复实时统计卡片中速度单位不一致的问题。原始数据行中速度的单位不同（Mb/秒、kb/秒等），但统计图没有转换成相同的单位，造成统计图不准确。从后端解决这个问题，输出 /api/stats/eth0/l 的时候，就把速度单位统一输出为 kb/秒。

# 项目概述
FlowMaster是一个专业的网络流量实时监控系统，使用vnstat作为后端数据源，提供实时流量统计、历史数据查询、多接口支持等功能。

---
*以下部分由 AI 在协议执行过程中维护*
---

# 分析 (由 RESEARCH 模式填充)
- 问题根源：实时统计API（/api/stats/eth0/l）没有进行单位统一处理
- 当前实现：只有['5,h', d', m, y']这些周期会进行单位归一化处理，实时统计（period='l'）被排除在外
- 影响：前端图表显示不准确，因为不同单位的数据直接用于绘图，没有统一换算

# 提议的解决方案 (由 INNOVATE 模式填充)
- 方案1：扩展现有单位归一化逻辑，添加对实时统计的支持
- 方案2创建独立的实时统计处理逻辑
- 方案3：修改翻译函数
- 选择方案1：复用现有架构，保持代码一致性

# 实施计划 (由 PLAN 模式生成)
1. 在server.js中添加normalizeRealtimeValue函数，支持实时统计单位转换2i/stats/:interface/:period路由，为实时统计（period=l）添加单位转换处理3. 更新翻译映射表，确保所有速度单位都被正确识别4. 测试实时统计API的单位转换功能
5. 验证前端图表显示的一致性

# 当前执行步骤 (由 EXECUTE 模式在开始执行某步骤时更新)
> 正在执行: 步骤13加单位转换函数和修改API路由"

# 任务进度 (由 EXECUTE 模式在每步完成后追加)
* 2025-1
  * 步骤：1. 在server.js中添加normalizeRealtimeValue函数，支持实时统计单位转换
  * 修改：server.js - 添加了normalizeRealtimeValue函数，支持b/秒、kb/秒、Mb/秒、Gb/秒等单位转换为kb/秒
  * 更改摘要：创建了专门的实时统计单位转换函数，修正了Gb/秒转换公式
  * 原因：执行计划步骤 1
  * 阻碍：无
  * 状态：待确认

* 202517 * 步骤：2. 修改/api/stats/:interface/:period路由，为实时统计（period='l）添加单位转换处理
  * 修改：server.js - 在单位归一化处理部分添加了实时统计单位转换逻辑
  * 更改摘要：为实时统计添加了专门的单位转换处理，使用正则表达式匹配速度信息
  * 原因：执行计划步骤 2
  * 阻碍：无
  * 状态：待确认

* 20251-27
  * 步骤：3. 更新翻译映射表，确保所有速度单位都被正确识别
  * 修改：server.js - 验证翻译映射表已包含所有必要的速度单位翻译
  * 更改摘要：确认翻译映射表已完整，包含b/秒、kb/秒、Mb/秒、Gb/秒等所有单位
  * 原因：执行计划步骤 3
  * 阻碍：无
  * 状态：待确认

# 最终审查 (由 REVIEW 模式填充)
[待完成] 